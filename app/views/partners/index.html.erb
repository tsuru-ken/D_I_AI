<h1>会社一覧</h1>

<%= form_with url: partners_path, method: :get, local: true do |form| %>

  <%= form.fields_for :q do |f| %>
    <%= f.label :costs_id_eq_any, "コスト感" %>
    <%= f.collection_select :costs_id_eq, Cost.all, :id, :breakdown, { include_blank: true } %>
  <% end %>

  <%= form.fields_for :q do |f| %>
    <%= f.label :service_contents_id_eq_any, "提供サービス" %>
    <%= f.collection_select :service_contents_id_eq, ServiceContent.all, :id, :division, { prompt: true } %>
  <% end %>

  <%= form.fields_for :q do |f| %>
    <%= f.label :ai_categories_id_eq_any, "AIカテゴリー" %>
    <%= f.collection_select :ai_categories_id_eq, AiCategory.all, :id, :genre, { prompt: true } %>
  <% end %>

  <%= form.fields_for :q do |f| %>
  <%= f.label :name_cont, "会社名でキーワード検索" %>
  <%= f.text_field :name_cont %>
<% end %>

  <%= form.submit "検索" %>

<% end %>

<table>
  <tr>
    <th>会社名</th>
    <th>クラウド/オンプレミス</th>
    <th>提供サービス</th>
    <th>AIカテゴリ</th>
    <th>コスト感</th>
    <th>技術者数</th>
    <th>製品情報</th>
    <th>導入事例</th>
    <th>詳細</th>
    <% if current_user %>
      <th>編集</th>
      <th>削除</th>
    <% end %>
  </tr>

<% @partners.each do |partner| %>
  <tr>
    <td><%= link_to partner.name, partner_path(partner.id) %></td>
    <td><%= partner.provision %></td>
    <%# 提供サービス %>
    <td>
      <% partner.service_contents.each do |service_content| %>
        <p>
          <%= service_content.division %>
        </p>
      <% end %>
    </td>
    <%# AIカテゴリ %>
    <td>
      <% partner.ai_categories.each do |ai_category| %>
        <p>
          <%= ai_category.genre %>
        </p>
      <% end %>
    </td>
    <%# コスト感 %>
    <td>
      <% partner.costs.each do |cost| %>
        <p>
          <%= cost.breakdown %>
        </p>
      <% end %>
    </td>
    <td><%= partner.engineer %></td>
    <td><%= partner.product %></td>
    <td><%= partner.case %></td> 
    <td><%= link_to '会社詳細画面', partner_path(partner.id) %></td>
    <% if partner.user == current_user %>
      <td><%= link_to "会社情報を編集する", edit_partner_path(partner.id) %></td>
      <td><%= link_to '会社情報を削除する', partner_path(partner.id), method: :delete ,data: { confirm: '本当に削除していいですか？' } %></td>
    <% else %>
      <td></td>
      <td></td>
    <% end %>
  </tr>
<% end %>
</table>
<%= link_to '新しく会社を登録する', new_partner_path %>